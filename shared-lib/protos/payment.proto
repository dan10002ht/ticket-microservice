syntax = "proto3";

package payment;

option java_multiple_files = true;
option java_package = "com.ticketing.payment.grpc";
option java_outer_classname = "PaymentProto";


import "google/protobuf/timestamp.proto";

// Payment Service
service PaymentService {
  rpc CreatePayment(CreatePaymentRequest) returns (PaymentResponse);
  rpc GetPayment(GetPaymentRequest) returns (PaymentResponse);
  rpc ListPayments(ListPaymentsRequest) returns (ListPaymentsResponse);
  rpc MarkPaymentSuccess(MarkPaymentSuccessRequest) returns (PaymentResponse);
  rpc MarkPaymentFailed(MarkPaymentFailedRequest) returns (PaymentResponse);
  rpc CapturePayment(CapturePaymentRequest) returns (PaymentResponse);
  rpc CancelPayment(CancelPaymentRequest) returns (PaymentResponse);

  rpc CreateRefund(CreateRefundRequest) returns (RefundResponse);
  rpc ListRefunds(ListRefundsRequest) returns (ListRefundsResponse);
  rpc UpdateRefundStatus(UpdateRefundStatusRequest) returns (RefundResponse);

  rpc Health(HealthRequest) returns (HealthResponse);
  rpc ProcessWebhook(ProcessWebhookRequest) returns (ProcessWebhookResponse);
}

message CreatePaymentRequest {
  string booking_id = 1;
  string ticket_id = 2;
  string user_id = 3;
  double amount = 4;
  string currency = 5;
  string payment_method = 6;
  string gateway_provider = 7;
  string idempotency_key = 8;
  map<string, string> metadata = 9;
}

message PaymentResponse {
  Payment payment = 1;
}

message GetPaymentRequest {
  string payment_id = 1;
}

message ListPaymentsRequest {
  string user_id = 1;
  string status = 2;
  int32 page = 3;
  int32 size = 4;
}

message ListPaymentsResponse {
  repeated Payment payments = 1;
  int64 total = 2;
}

message MarkPaymentSuccessRequest {
  string payment_id = 1;
  string external_reference = 2;
}

message MarkPaymentFailedRequest {
  string payment_id = 1;
  string failure_reason = 2;
}

message CapturePaymentRequest {
  string payment_id = 1;
}

message CancelPaymentRequest {
  string payment_id = 1;
  string reason = 2;
}

message CreateRefundRequest {
  string payment_id = 1;
  double amount = 2;
  string reason = 3;
  string description = 4;
  string refund_type = 5;
  string idempotency_key = 6;
  map<string, string> metadata = 7;
}

message RefundResponse {
  Refund refund = 1;
}

message ListRefundsRequest {
  string payment_id = 1;
}

message ListRefundsResponse {
  repeated Refund refunds = 1;
}

message UpdateRefundStatusRequest {
  string refund_id = 1;
  string status = 2;
  string external_reference = 3;
  string failure_reason = 4;
}

message ProcessWebhookRequest {
  string gateway = 1;
  string payload = 2;
  map<string, string> headers = 3;
}

message ProcessWebhookResponse {
  bool success = 1;
  string message = 2;
}

message HealthRequest {
  string service = 1;
}

message HealthResponse {
  string status = 1;
  string message = 2;
  map<string, string> details = 3;
}

message Payment {
  string id = 1;
  string payment_id = 2;
  string booking_id = 3;
  string ticket_id = 4;
  string user_id = 5;
  double amount = 6;
  string currency = 7;
  string payment_method = 8;
  string status = 9;
  string gateway_provider = 10;
  string external_reference = 11;
  string failure_reason = 12;
  string description = 13;
  map<string, string> metadata = 14;
  string idempotency_key = 15;
  google.protobuf.Timestamp created_at = 16;
  google.protobuf.Timestamp updated_at = 17;
  google.protobuf.Timestamp paid_at = 18;
  google.protobuf.Timestamp cancelled_at = 19;
}

message Refund {
  string id = 1;
  string refund_id = 2;
  string payment_id = 3;
  double amount = 4;
  string currency = 5;
  string refund_type = 6;
  string status = 7;
  string gateway_provider = 8;
  string reason = 9;
  string description = 10;
  string failure_reason = 11;
  map<string, string> metadata = 12;
  google.protobuf.Timestamp created_at = 13;
  google.protobuf.Timestamp updated_at = 14;
  google.protobuf.Timestamp refunded_at = 15;
  google.protobuf.Timestamp cancelled_at = 16;
}